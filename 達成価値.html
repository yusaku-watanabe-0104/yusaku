<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>数列の達成価値ジェネレーター</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f7f7f7;
      text-align: center;
      padding: 2rem;
    }
    .character {
      position: relative;
      display: inline-block;
      margin-bottom: 1rem;
    }
    .character img {
      width: 200px;
    }
    .bubble {
      position: absolute;
      top: 0;
      left: 210px;
      background-color: #fff;
      border: 2px solid #333;
      border-radius: 10px;
      padding: 10px;
      width: 250px;
      text-align: left;
      box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
    }
    input, button {
      font-size: 1rem;
      padding: 0.5rem;
      margin: 0.5rem;
      width: 200px;
    }
    #result {
      margin-top: 2rem;
      font-weight: bold;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h2>数列の達成価値ジェネレーター</h2>

  <div class="character">
    <img src="https://illust8.com/wp-content/uploads/2023/06/senior_teacher_18894.png" alt="キャラ">
    <div class="bubble" id="bubbleText">こんにちは！年齢を教えてね。</div>
  </div>

  <br>
  <input id="userInput" type="text" placeholder="ここに入力">
  <br>
  <button onclick="handleInput()">送信</button>

  <div id="result"></div>

  <script>
    let step = 0;
    const answers = {};
    const bubble = document.getElementById("bubbleText");
    const resultDiv = document.getElementById("result");

    async function handleInput() {
      const input = document.getElementById("userInput").value.trim();
      if (!input) return;

      if (step === 0) {
        answers.age = input;
        bubble.textContent = "ありがとう！次に出身地を教えてね。";
        step++;
      } else if (step === 1) {
        answers.place = input;
        bubble.textContent = "なるほど〜。最後に趣味を教えて！";
        step++;
      } else if (step === 2) {
        answers.hobby = input;
        bubble.textContent = "考え中... 少し待ってね。";
        step++;
        await generateCompletion();
      }

      document.getElementById("userInput").value = "";
    }

    async function generateCompletion() {
      const prompt = `私は現在${answers.age}歳で${answers.place}で育ちました。${answers.hobby}をすることが好きです。この情報を頼りに私にあった数列の分野の達成価値（数列を学ぶ重要性）を200文字程度で教えてください。`;

      try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer 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"  
          },
          body: JSON.stringify({
            model: "gpt-3.5-turbo",
            messages: [{ role: "user", content: prompt }],
            max_tokens: 300,  // トークン数を増やして200文字程度に調整
            temperature: 0.7
          })
        });

        const data = await response.json();
        const reply = data.choices?.[0]?.message?.content?.trim() ?? "応答が取得できませんでした。";
        bubble.textContent = "できたよ！";
        resultDiv.textContent = reply;

      } catch (err) {
        bubble.textContent = "エラーが発生しました。";
        resultDiv.textContent = String(err);
      }
    }
  </script>
</body>
</html>
